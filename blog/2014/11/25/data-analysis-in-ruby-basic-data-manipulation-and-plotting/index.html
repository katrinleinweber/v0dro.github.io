
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Data Analysis in RUby: Basic Data Manipulation and Plotting - Travel &lt;code&gt; Music</title>
  <meta name="author" content="Sameer Deshmukh">

  
  <meta name="description" content="daru (Data Analysis in RUby) is a ruby gem for performing various data analysis and manipulation tasks in Ruby. It draws inspiration from pandas ( &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://v0dro.github.io/blog/2014/11/25/data-analysis-in-ruby-basic-data-manipulation-and-plotting">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Travel &lt;code&gt; Music" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-55005305-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Travel &lt;code&gt; Music</a></h1>
  
    <h2>A place where I share my experiences with Travel, Programming and Music</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:v0dro.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/archives">Archive</a></li>
  <li><a href="/travel">Travel</a></li>
  <li><a href="/code">Code</a></li>
  <li><a href="/music">Music</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Data Analysis in RUby: Basic Data Manipulation and Plotting</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-25T13:55:13+05:30'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:55 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>daru (Data Analysis in RUby) is a ruby gem for performing various data analysis and manipulation tasks in Ruby. It draws inspiration from pandas (python) and aims to be completely cross-compatible between all ruby implementations (MRI/JRuby etc.) yet leverage the individual benefits that each interpreter offers (for example the speed of C in MRI), while offering a simple and powerful API for data analysis, manipulation and visualization.</p>

<p>In this first article on daru, I will show you some aspects of how daru handles data and some operations that can be performed on a real-life data set.</p>

<h2 id="getting-started">Getting Started</h2>

<p>daru consists of two major data structures:</p>

<ul>
  <li><strong>Vector</strong> - A named one-dimensional array-like structure.</li>
  <li><strong>DataFrame</strong> - A named spreadsheet-like two-dimensional frame of data.</li>
</ul>

<p>A <em>Vector</em> can either be represented by a Ruby Array, NMatrix(MRI) or MDArray(JRuby) internally. This allows for fast data manipulation in native code. Users can change the underlying implementation at will (demonstrated in the <a href="/blog/2015/02/24/data-analysis-in-ruby-part-2/">next</a> blog post).</p>

<p>Both of these can be indexed by the <code>Daru::Index</code> or <code>Daru::MultiIndex</code> class, which allows us to reference and operate on data by name instead of the traditional numeric indexing, and also perform index-based manipulation, equality and plotting operations.</p>

<h4 id="vector">Vector</h4>

<p>The easiest way to create a vector is to simply pass the elements to a <code>Daru::Vector</code> constructor:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">v</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">Vector</span><span class="o">.</span><span class="n">new</span> <span class="o">[</span><span class="mi">23</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">11</span><span class="o">]</span>
</span><span class="line">
</span><span class="line"><span class="c1"># This will create a Vector object v</span>
</span><span class="line">
</span><span class="line"><span class="c1"># =&gt; </span>
</span><span class="line"><span class="c1">##&lt;Daru::Vector:78168790 @name = nil @size = 5 &gt;</span>
</span><span class="line"><span class="c1">#   ni</span>
</span><span class="line"><span class="c1"># 0 23</span>
</span><span class="line"><span class="c1"># 1 44</span>
</span><span class="line"><span class="c1"># 2 66</span>
</span><span class="line"><span class="c1"># 3 22</span>
</span><span class="line"><span class="c1"># 4 11</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Since no name has been specified, the vector is named <code>nil</code>, and since no index has been specified either, a numeric index from 0..4 has been generated for the vector (leftmost column).</p>

<p>A better way to create vectors would be to specify the name and the indexes:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">sherlock</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">Vector</span><span class="o">.</span><span class="n">new</span> <span class="o">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">]</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="ss">:sherlock</span><span class="p">,</span> <span class="ss">index</span><span class="p">:</span> <span class="o">[</span><span class="ss">:pipe</span><span class="p">,</span> <span class="ss">:hat</span><span class="p">,</span> <span class="ss">:violin</span><span class="p">,</span> <span class="ss">:cloak</span><span class="p">,</span> <span class="ss">:shoes</span><span class="o">]</span>
</span><span class="line">
</span><span class="line"><span class="c1">#=&gt; </span>
</span><span class="line"><span class="c1">#&lt;Daru::Vector:78061610 @name = sherlock @size = 5 &gt;</span>
</span><span class="line"><span class="c1">#         sherlock</span>
</span><span class="line"><span class="c1">#    pipe       3</span>
</span><span class="line"><span class="c1">#     hat       2</span>
</span><span class="line"><span class="c1">#  violin       1</span>
</span><span class="line"><span class="c1">#   cloak       1</span>
</span><span class="line"><span class="c1">#   shoes       2</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This way we can clearly see the quantity of each item possesed by Sherlock.</p>

<p>Data can be retrieved with the <code>[]</code> operator:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">sherlock</span><span class="o">[</span><span class="ss">:pipe</span><span class="o">]</span> <span class="c1">#=&gt; 3</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="dataframe">DataFrame</h4>

<p>A basic DataFrame can be constructed by simply specifying the names of columns and their corresponding values in a hash:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">df</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">DataFrame</span><span class="o">.</span><span class="n">new</span><span class="p">({</span><span class="ss">a</span><span class="p">:</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="o">]</span><span class="p">,</span> <span class="ss">b</span><span class="p">:</span> <span class="o">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="o">]</span><span class="p">},</span> <span class="nb">name</span><span class="p">:</span> <span class="ss">:normal</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1"># =&gt; </span>
</span><span class="line"><span class="c1">##&lt;Daru::DataFrame:77782370 @name = normal @size = 5&gt;</span>
</span><span class="line"><span class="c1">#            a      b </span>
</span><span class="line"><span class="c1">#     0      1     10 </span>
</span><span class="line"><span class="c1">#     1      2     20 </span>
</span><span class="line"><span class="c1">#     2      3     30 </span>
</span><span class="line"><span class="c1">#     3      4     40 </span>
</span><span class="line"><span class="c1">#     4      5     50 </span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>You can also specify an index for the DataFrame alongwith the data and also specify the order in which the vectors should appear. Every vector in the DataFrame will carry the same index as the DataFrame once it has been created.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">plus_one</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">DataFrame</span><span class="o">.</span><span class="n">new</span><span class="p">({</span><span class="ss">a</span><span class="p">:</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="o">]</span><span class="p">,</span> <span class="ss">b</span><span class="p">:</span> <span class="o">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="o">]</span><span class="p">,</span> <span class="ss">c</span><span class="p">:</span> <span class="o">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">44</span><span class="p">,</span><span class="mi">55</span><span class="o">]</span><span class="p">},</span> <span class="nb">name</span><span class="p">:</span> <span class="ss">:plus_one</span><span class="p">,</span> <span class="ss">index</span><span class="p">:</span> <span class="o">[</span><span class="ss">:a</span><span class="p">,</span> <span class="ss">:e</span><span class="p">,</span> <span class="ss">:i</span><span class="p">,</span> <span class="ss">:o</span><span class="p">,</span> <span class="ss">:u</span><span class="o">]</span><span class="p">,</span> <span class="ss">order</span><span class="p">:</span> <span class="o">[</span><span class="ss">:c</span><span class="p">,</span> <span class="ss">:a</span><span class="p">,</span> <span class="ss">:b</span><span class="o">]</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c1"># =&gt; </span>
</span><span class="line"><span class="c1">##&lt;Daru::DataFrame:77605450 @name = plus_one @size = 5&gt;</span>
</span><span class="line"><span class="c1">#                c        a        b </span>
</span><span class="line"><span class="c1">#       a       11        1       10 </span>
</span><span class="line"><span class="c1">#       e       22        2       20 </span>
</span><span class="line"><span class="c1">#       i       33        3       30 </span>
</span><span class="line"><span class="c1">#       o       44        4       40 </span>
</span><span class="line"><span class="c1">#       u       55        5       50</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>daru will also add <code>nil</code> values to vectors that fall short of elements.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">missing</span> <span class="o">=</span>  <span class="no">Daru</span><span class="o">::</span><span class="no">DataFrame</span><span class="o">.</span><span class="n">new</span><span class="p">({</span><span class="ss">a</span><span class="p">:</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="ss">b</span><span class="p">:</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">},</span> <span class="nb">name</span><span class="p">:</span> <span class="ss">:missing</span><span class="p">)</span>
</span><span class="line"><span class="c1">#=&gt; </span>
</span><span class="line"><span class="c1">#&lt;Daru::DataFrame:76043900 @name = missing @size = 3&gt;</span>
</span><span class="line"><span class="c1">#                    a          b </span>
</span><span class="line"><span class="c1">#         0          1          1 </span>
</span><span class="line"><span class="c1">#         1          2        nil </span>
</span><span class="line"><span class="c1">#         2          3        nil </span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Creating a DataFrame by specifying <code>Vector</code> objects in place of the values in the hash will correctly align the values according to the index of each vector. If a vector is missing an index present in another vector, that index will be added to the vector with the corresponding value set to <code>nil</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">a</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">Vector</span><span class="o">.</span><span class="n">new</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="o">]</span><span class="p">,</span> <span class="ss">index</span><span class="p">:</span> <span class="o">[</span><span class="ss">:a</span><span class="p">,</span> <span class="ss">:e</span><span class="p">,</span> <span class="ss">:i</span><span class="p">,</span> <span class="ss">:o</span><span class="p">,</span> <span class="ss">:u</span><span class="o">]</span>
</span><span class="line"><span class="n">b</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">Vector</span><span class="o">.</span><span class="n">new</span> <span class="o">[</span><span class="mi">43</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">13</span><span class="o">]</span><span class="p">,</span> <span class="ss">index</span><span class="p">:</span> <span class="o">[</span><span class="ss">:i</span><span class="p">,</span> <span class="ss">:a</span><span class="p">,</span> <span class="ss">:queen</span><span class="o">]</span>
</span><span class="line"><span class="n">on_steroids</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">DataFrame</span><span class="o">.</span><span class="n">new</span><span class="p">({</span><span class="ss">a</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="ss">b</span><span class="p">:</span> <span class="n">b</span><span class="p">},</span> <span class="nb">name</span><span class="p">:</span> <span class="ss">:on_steroids</span><span class="p">)</span>
</span><span class="line"><span class="c1">#=&gt; </span>
</span><span class="line"><span class="c1">#&lt;Daru::DataFrame:75841450 @name = on_steroids @size = 6&gt;</span>
</span><span class="line"><span class="c1">#                    a          b </span>
</span><span class="line"><span class="c1">#         a          1         22 </span>
</span><span class="line"><span class="c1">#         e          2        nil </span>
</span><span class="line"><span class="c1">#         i          3         43 </span>
</span><span class="line"><span class="c1">#         o          4        nil </span>
</span><span class="line"><span class="c1">#     queen        nil         13 </span>
</span><span class="line"><span class="c1">#         u          5        nil </span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>A DataFrame can be constructed from multiple sources:</p>

<ul>
  <li>To construct by columns:
    <ul>
      <li><strong>Array of hashes</strong> - Where the key of each hash is the name of the column to which the value belongs.</li>
      <li><strong>Name-Array Hash</strong> - Where the hash key is set as the name of the vector and the data the corresponding value.</li>
      <li><strong>Name-Vector Hash</strong> - This is the most advanced way of creating a DataFrame. Treats the hash key as the name of the vector. Also aligns the data correctly based on index.</li>
      <li><strong>Array of Arrays</strong> - Each sub array will be considered as a Vector in the DataFrame.</li>
    </ul>
  </li>
  <li>To construct by rows using the <code>.rows</code> class method:
    <ul>
      <li><strong>Array of Arrays</strong> - This will treat each sub-array as an independent row.</li>
      <li><strong>Array of Vectors</strong> - Uses each Vector in the Array as a row of the DataFrame. Sets vector names according to the index of the Vector. Aligns vector elements by index.</li>
    </ul>
  </li>
</ul>

<h2 id="handling-data">Handling Data</h2>

<p>Now that you have a basic idea about representing data in daru, lets see some more features of daru by loading some real-life data from a CSV file and performing some operations on it.</p>

<p>For this purpose, we will use <a href="https://rubygems.org/gems/iruby">iruby</a> notebook, with which daru is compatible. iruby provides a great interface for visualizing and playing around with data. I highly recommend installing it for full utilization of this tutorial.</p>

<h4 id="loading-data-from-files">Loading Data From Files</h4>

<p>Let us load some data about the music listening history of one user from this subset of the <a href="https://github.com/v0dro/daru/blob/master/spec/fixtures/music_data.tsv">Last.fm data set</a>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="nb">require</span> <span class="s1">&#39;daru&#39;</span>
</span><span class="line">
</span><span class="line"><span class="n">df</span> <span class="o">=</span> <span class="no">Daru</span><span class="o">::</span><span class="no">DataFrame</span><span class="o">.</span><span class="n">from_csv</span> <span class="s1">&#39;music_data.tsv&#39;</span><span class="p">,</span> <span class="ss">col_sep</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img class="center" src="/images/daru1/create_music_df.png" title="'Create a DataFrame from a TSV file.'" /></p>

<p>As you can see the <em>timestamp</em> field is in a somewhat non-Ruby format which is pretty difficult for the default Time class to understand, so we destructively map time zone information (IST in this case) and then change every <em>timestamp</em> string field into a Ruby <em>Time</em> object, so that operations on time can be easily performed.</p>

<p>Notice the syntax for referencing a particular vector. Use ‘row’ for referencing any row.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">df</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">recode!</span> <span class="p">{</span> <span class="o">|</span><span class="n">ts</span><span class="o">|</span> <span class="n">ts</span> <span class="o">+=</span> <span class="s2">&quot;+5:30&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p><img class="center" src="/images/daru1/dmap_vector.png" title="'Destructively map a given vector.'" /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="nb">require</span> <span class="s1">&#39;date&#39;</span>
</span><span class="line"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">recode</span><span class="p">(</span><span class="ss">:row</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
</span><span class="line">  <span class="n">row</span><span class="o">[</span><span class="ss">:timestamp</span><span class="o">]</span> <span class="o">=</span> <span class="no">DateTime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">row</span><span class="o">[</span><span class="ss">:timestamp</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-%dT%H:%M:%SZ%z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_time</span>
</span><span class="line">  <span class="n">row</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img class="center" src="/images/daru1/df_row_map.png" title="center 'Map all rows of a DataFrame.'" /></p>

<h4 id="basic-querying">Basic Querying</h4>

<p>A bunch of rows can be selected by specifying a range:</p>

<p><code>df.row[900..923]</code></p>

<p><img class="center" src="/images/daru1/range_row_access.png" title="center 'Accessing rows with a range'" /></p>

<h4 id="data-analysis">Data Analysis</h4>

<p>Lets dive deeper by actually trying to extract something useful from the data that we have. Say we want to know the name of the artist heard the maximum number of times. So we create a Vector which consists of the names of the artists as the index and the number of times the name appears in the data as the corresponding values:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="c1"># Group by artist name and call &#39;size&#39; to see the number of rows each artist populates.</span>
</span><span class="line"><span class="n">artists</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="ss">:artname</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img class="center" src="/images/daru1/get_max_artists.png" title="'Create a vector of artist names vs number of times they appear.'" /></p>

<p>To get the maximum value out of these, use <code>#max_index</code>. This will return a Vector which has the max:</p>

<p><code>count.max_index</code></p>

<p><img class="center" src="/images/daru1/artists_max.png" title="'Obtain the most heard artist.'" /></p>

<h4 id="plotting">Plotting</h4>

<p>daru uses <a href="https://github.com/domitry/nyaplot">Nyaplot</a> for plotting, which is an optional dependency. Install nyaplot with <code>gem install nyaplot</code> and proceed.</p>

<p>To demonstrate, lets find the top ten artists heard by this user and plot the number of times their songs have been heard against their names in a bar graph. For this, use the <code>#sort</code> function, which will preserve the indexing of the vector.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">top_ten</span> <span class="o">=</span> <span class="n">artists</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="ss">ascending</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">10</span><span class="o">]</span>
</span><span class="line">
</span><span class="line"><span class="n">top_ten</span><span class="o">.</span><span class="n">plot</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:bar</span> <span class="k">do</span> <span class="o">|</span><span class="n">plt</span><span class="o">|</span>
</span><span class="line">  <span class="n">plt</span><span class="o">.</span><span class="n">width</span> <span class="mi">1120</span>
</span><span class="line">  <span class="n">plt</span><span class="o">.</span><span class="n">height</span> <span class="mi">500</span>
</span><span class="line">  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span> <span class="kp">true</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><img class="center" src="/images/daru1/plot_top_ten.png" title="'Top ten artists plotted.'" /></p>

<p>More examples can be found in <a href="https://github.com/v0dro/daru#notebooks">the notebooks section of the daru README</a>.</p>

<h2 id="further-reading">Further Reading</h2>

<ul>
  <li>This was but a very small subset of the capabilities of daru. Go through the <a href="https://rubygems.org/gems/daru">documentation</a> for more methods of analysing your data with daru.</li>
  <li>You can find all the above examples implemented in <a href="http://nbviewer.ipython.org/github/v0dro/daru/blob/master/notebooks/intro_with_music_data_.ipynb">this notebook</a>.</li>
  <li>Contribute to daru on <a href="https://github.com/v0dro/daru">github</a>. Any contributions will be greatly appreciated!</li>
  <li>Many thanks to <a href="http://www.last.fm/">last.fm</a> for providing the data.</li>
  <li>Check out the <a href="/blog/2015/02/24/data-analysis-in-ruby-part-2/">next blog post in this series</a>, elaborating on the next release of daru.</li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Sameer Deshmukh</span></span>

      




<time class='entry-date' datetime='2014-11-25T13:55:13+05:30'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:55 pm</span></time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://v0dro.github.io/blog/2014/11/25/data-analysis-in-ruby-basic-data-manipulation-and-plotting/" data-via="v0dro" data-counturl="http://v0dro.github.io/blog/2014/11/25/data-analysis-in-ruby-basic-data-manipulation-and-plotting/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/10/12/accessing-matrix-elements-when-expressed-as-a-contiguous-1d-array/" title="Previous Post: Accessing matrix elements when expressed as a contiguous 1D array">&laquo; Accessing matrix elements when expressed as a contiguous 1D array</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/11/29/one-dimensional-interpolation-introduction-and-implementation-in-ruby/" title="Next Post: One Dimensional Interpolation: Introduction And Implementation In Ruby">One Dimensional Interpolation: Introduction And Implementation In Ruby &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/08/21/setting-up-a-lexical-analyser-and-parser-in-ruby/">Setting Up a Lexical Analyser and Parser in Ruby</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/16/random-thoughts-on-music-theory/">Random Thoughts on Music Theory.</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/05/searching-for-graduate-degree-courses-in-usa-and-japan/">Searching for Graduate Degree Courses in USA and Japan.</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/12/random-thoughts-on-bass-tone/">Random Thoughts on Bass Tone</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/07/05/making-screencasts-in-debian/">Making Screencasts in Debian</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/v0dro">@v0dro</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'v0dro',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Sameer Deshmukh -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'v0dro';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://v0dro.github.io/blog/2014/11/25/data-analysis-in-ruby-basic-data-manipulation-and-plotting/';
        var disqus_url = 'http://v0dro.github.io/blog/2014/11/25/data-analysis-in-ruby-basic-data-manipulation-and-plotting/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
